<html>
    <head>
        <title>
            TODO
        </title>
    </head>
    <script>
        function addTodo(){
            const taskTitle = document.getElementById("title").value;
            const taskDesc = document.getElementById("description").value;

            if(taskTitle !="" && taskDesc!= ""){
            
            let tasks = JSON.parse(localStorage.getItem("tasks")) || []

            const newTask = {taskTitle,taskDesc};

            tasks.push(newTask)
            localStorage.setItem("tasks" , JSON.stringify(tasks))
            localStoring();
            
            // console.log(btnlength)
            // console.log(a)
            // console.log(b)

            document.getElementById("title").value = '';
            document.getElementById("description").value = '';

            }
            else{
                if(taskTitle == "") alert("Enter some task you idiot")
                else alert("enter some bloody description")
            }
        }
        

        function localStoring(){

            const rootDiv = document.getElementById("todo");
            rootDiv.innerHTML = "";

            let tasks = JSON.parse(localStorage.getItem("tasks")) || []

            tasks.forEach((task , index) => {

                const containerDiv = document.createElement('div')
                const taskIp = document.createElement('div')
                const desc = document.createElement('div')
                const editBtn = document.createElement('button')
                const doneBtn = document.createElement('button')
                
                containerDiv.innerHTML = '<br />'
                taskIp.innerText = `task : ${task.taskTitle}`
                desc.innerText = `description : ${task.taskDesc}`
                editBtn.innerText = "Edit"
                doneBtn.innerText = "Mark as Done"

                editBtn.addEventListener("click" , ()=>editHandle(index))
                doneBtn.addEventListener("click" , () => clickHandle(index))

                rootDiv.appendChild(containerDiv)
                containerDiv.appendChild(taskIp);
                containerDiv.appendChild(desc);
                containerDiv.appendChild(editBtn);
                containerDiv.appendChild(doneBtn);
            })
            //     document.getElementById("todo").innerHTML +=  
            // `<div id = "t${index}">
            //     <br />
            //     <div>task : ${task.taskTitle}</div>
            //     <div>desc : ${task.taskDesc}</div>
            //     <button onclick = "editHandle(${index})">edit</button>
            //     <button onclick = "clickHandle(${index})">Mark as done</button>
            // </div>`                
            // });


            const crossedDiv = document.getElementById("crossedTodo")

            let crossedTasks = JSON.parse(localStorage.getItem("crossedTasks")) || [];

            if(crossedTasks == 0) {
                const non = document.createElement('div');
                non.innerText = 'none';
                crossedDiv.appendChild(non)
            }
            else{
            crossedTasks.forEach((task, index) => {
                document.getElementById("crossedTodo").innerHTML += `
                <br />
                <div><s>task : ${task.taskTitle}</s></div>
                <div><s>desc : ${task.taskDesc}</s></div>
                </div>
                `
            });
        }
        }

        // function crossedTasks() {
        //     const rootDiv = document.getElementById("crossedTodo")
        //     rootDiv.innerHTML = "";

        //     let crossedTasks = JSON.parse(localStorage.getItem("crossedTasks"));

        //     crossedTasks.forEach((task, index) => {
        //         rootDiv.innerHTML += `
        //         <div id=${index}>
        //         <div>task : ${task.a}</div>
        //         <div>desc : ${task.b}</div>
        //         </div>
        //         `
        //     });
        // }

        // function clickHandle(id){
        //     console.log(JSON.parse(id))
        //     let taskArray = JSON.parse(localStorage.getItem("tasks")) || [];
        //     let x = taskArray.splice(id,1)
        //     console.log(x)
        //     localStorage.setItem("tasks",JSON.stringify(taskArray))
        //     localStoring()

        // }

        function clickHandle(id){
            let taskArray = JSON.parse(localStorage.getItem("tasks")) || [];
            let x = taskArray.splice(id,1);
            
            let crossedArray = JSON.parse(localStorage.getItem("crossedTasks")) || [];
            console.log(x[0])
            let arr = x[0]
            console.log(arr)
            crossedArray.push(arr)

            localStorage.setItem("tasks" , JSON.stringify(taskArray))
            localStorage.setItem("crossedTasks", JSON.stringify(crossedArray))
            localStoring();

            // crossedTasks();
        }

    


        function editHandle(id){

            let taskArray = JSON.parse(localStorage.getItem("tasks")) || [];

            document.getElementById(`t${id}`).innerHTML = `
            <br />
            <label for="task${id}">task: </label>
            <input type="text" id="task${id}" value="${taskArray[id].taskTitle}" />
            <br />
            <label for="desc${id}">desc: </label>
            <input type="text" id="desc${id}" value="${taskArray[id].taskDesc}" />
            <button onClick = "saveHandle(${id})">save</button>
            <button onClick = "localStoring()">cancel</button>
            `            
        }

        function saveHandle(id){
            let taskArray = JSON.parse(localStorage.getItem("tasks")) || [];

            let taskTitle = document.getElementById(`task${id}`).value;
            let taskDesc = document.getElementById(`desc${id}`).value;

            console.log({taskTitle, taskDesc})
            if(taskTitle != '' && taskDesc != ''){
                taskArray[id] = {taskTitle, taskDesc}
            }else{
                alert("Fill all the details")
            }
            
            localStorage.setItem("tasks",JSON.stringify(taskArray))

            localStoring();
        }

        
    </script>
    <body onload="localStoring()">
        <div>
        <input id="title" type="text" placeholder="title"></input>
        <br></br>
        <input id="description" type="text" placeholder="description"></input>
        <br></br>
        <button onclick="addTodo()">Add todo</button>
        </div>
        <div id="todo"></div>
        <div id="crossedTodo"><br /> <b style="text-decoration: underline;">Completed Tasks : </b><br /></div>
    </body>
</html>